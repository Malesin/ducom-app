{"version":3,"names":["Lazy","children","cancelLazyFadeIn","startMounted","_startMounted","mountDelayMs","name","focusedTab","refMap","value","didTriggerLayout","canMount","setCanMount","React","useState","isSelfMounted","useRef","opacity","useEffect","current","startMountTimer","useCallback","setTimeout","focused","wasFocused","scrollTo","ref","isMounted","wasMounted","stylez","onLayout","styles","container","undefined","StyleSheet","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React, { useCallback } from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  /**\n   * Whether to cancel the lazy fade in animation. Defaults to false.\n   */\n  cancelLazyFadeIn?: boolean\n  /**\n   * How long to wait before mounting the children.\n   */\n  mountDelayMs?: number\n  /**\n   * Whether to start mounted. Defaults to true if we are the focused tab.\n   */\n  startMounted?: boolean\n  children: React.ReactElement\n}> = ({\n  children,\n  cancelLazyFadeIn,\n  startMounted: _startMounted,\n  mountDelayMs = 50,\n}) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap } = useTabsContext()\n\n  /**\n   * We start mounted if we are the focused tab, or if props.startMounted is true.\n   */\n  const startMounted = useSharedValue(\n    typeof _startMounted === 'boolean'\n      ? _startMounted\n      : focusedTab.value === name\n  )\n\n  /**\n   * We keep track of whether a layout has been triggered\n   */\n  const didTriggerLayout = useSharedValue(false)\n\n  /**\n   * This is used to control when children are mounted\n   */\n  const [canMount, setCanMount] = React.useState(!!startMounted.value)\n  /**\n   * Ensure we don't mount after the component has been unmounted\n   */\n  const isSelfMounted = React.useRef(true)\n\n  const opacity = useSharedValue(cancelLazyFadeIn || startMounted.value ? 1 : 0)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const startMountTimer = React.useCallback(() => {\n    // wait the scene to be at least mountDelay ms focused, before mounting\n    setTimeout(() => {\n      if (focusedTab.value === name) {\n        if (isSelfMounted.current) setCanMount(true)\n      }\n    }, mountDelayMs)\n  }, [focusedTab.value, mountDelayMs, name])\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused, wasFocused) => {\n      if (focused && !wasFocused && !canMount) {\n        if (cancelLazyFadeIn) {\n          opacity.value = 1\n          runOnJS(setCanMount)(true)\n        } else {\n          runOnJS(startMountTimer)()\n        }\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useAnimatedReaction(\n    () => {\n      return didTriggerLayout.value\n    },\n    (isMounted, wasMounted) => {\n      if (isMounted && !wasMounted) {\n        if (!cancelLazyFadeIn && opacity.value !== 1) {\n          opacity.value = withTiming(1)\n        }\n      }\n    },\n    [ref, cancelLazyFadeIn, name, didTriggerLayout, scrollTo]\n  )\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [])\n\n  const onLayout = useCallback(() => {\n    didTriggerLayout.value = true\n  }, [didTriggerLayout])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn ? stylez : undefined]}\n        onLayout={onLayout}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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"}