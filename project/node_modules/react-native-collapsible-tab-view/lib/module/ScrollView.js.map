{"version":3,"names":["React","Animated","useAfterMountEffect","useChainCallback","useCollapsibleStyle","useConvertAnimatedToValue","useScrollHandlerY","useSharedAnimatedRef","useTabNameContext","useTabsContext","useUpdateScrollViewContentSize","ScrollViewMemo","memo","forwardRef","props","passRef","ScrollView","contentContainerStyle","style","onContentSizeChange","children","refreshControl","rest","name","ref","setRef","contentInset","_style","_contentContainerStyle","progressViewOffset","scrollHandler","enable","onLayout","useEffect","scrollContentSizeChange","scrollContentSizeChangeHandlers","useMemo","memoRefreshControl","cloneElement","contentInsetValue","memoContentInset","top","memoContentOffset","x","y","memoContentContainerStyle","memoStyle"],"sources":["ScrollView.tsx"],"sourcesContent":["import React from 'react'\nimport { ScrollViewProps, ScrollView as RNScrollView } from 'react-native'\nimport Animated from 'react-native-reanimated'\n\nimport {\n  useAfterMountEffect,\n  useChainCallback,\n  useCollapsibleStyle,\n  useConvertAnimatedToValue,\n  useScrollHandlerY,\n  useSharedAnimatedRef,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\nconst ScrollViewMemo = React.memo(\n  React.forwardRef<RNScrollView, React.PropsWithChildren<ScrollViewProps>>(\n    (props, passRef) => {\n      return (\n        <Animated.ScrollView\n          // @ts-expect-error reanimated types are broken on ref\n          ref={passRef}\n          {...props}\n        />\n      )\n    }\n  )\n)\n\n/**\n * Use like a regular ScrollView.\n */\nexport const ScrollView = React.forwardRef<\n  RNScrollView,\n  React.PropsWithChildren<Omit<ScrollViewProps, 'onScroll'>>\n>(\n  (\n    {\n      contentContainerStyle,\n      style,\n      onContentSizeChange,\n      children,\n      refreshControl,\n      ...rest\n    },\n    passRef\n  ) => {\n    const name = useTabNameContext()\n    const ref = useSharedAnimatedRef<RNScrollView>(passRef)\n    const { setRef, contentInset } = useTabsContext()\n    const {\n      style: _style,\n      contentContainerStyle: _contentContainerStyle,\n      progressViewOffset,\n    } = useCollapsibleStyle()\n    const { scrollHandler, enable } = useScrollHandlerY(name)\n    const onLayout = useAfterMountEffect(rest.onLayout, () => {\n      'worklet'\n      // we enable the scroll event after mounting\n      // otherwise we get an `onScroll` call with the initial scroll position which can break things\n      enable(true)\n    })\n\n    React.useEffect(() => {\n      setRef(name, ref)\n    }, [name, ref, setRef])\n\n    const scrollContentSizeChange = useUpdateScrollViewContentSize({\n      name,\n    })\n\n    const scrollContentSizeChangeHandlers = useChainCallback(\n      React.useMemo(() => [scrollContentSizeChange, onContentSizeChange], [\n        onContentSizeChange,\n        scrollContentSizeChange,\n      ])\n    )\n\n    const memoRefreshControl = React.useMemo(\n      () =>\n        refreshControl &&\n        React.cloneElement(refreshControl, {\n          progressViewOffset,\n          ...refreshControl.props,\n        }),\n      [progressViewOffset, refreshControl]\n    )\n\n    const contentInsetValue = useConvertAnimatedToValue(contentInset)\n\n    const memoContentInset = React.useMemo(() => ({ top: contentInsetValue }), [\n      contentInsetValue,\n    ])\n\n    const memoContentOffset = React.useMemo(\n      () => ({ x: 0, y: -contentInsetValue }),\n      [contentInsetValue]\n    )\n\n    const memoContentContainerStyle = React.useMemo(\n      () => [\n        _contentContainerStyle,\n        // TODO: investigate types\n        contentContainerStyle as any,\n      ],\n      [_contentContainerStyle, contentContainerStyle]\n    )\n    const memoStyle = React.useMemo(() => [_style, style], [_style, style])\n\n    return (\n      <ScrollViewMemo\n        {...rest}\n        onLayout={onLayout}\n        ref={ref}\n        bouncesZoom={false}\n        style={memoStyle}\n        contentContainerStyle={memoContentContainerStyle}\n        onScroll={scrollHandler}\n        onContentSizeChange={scrollContentSizeChangeHandlers}\n        scrollEventThrottle={16}\n        contentInset={memoContentInset}\n        contentOffset={memoContentOffset}\n        automaticallyAdjustContentInsets={false}\n        refreshControl={memoRefreshControl}\n        // workaround for: https://github.com/software-mansion/react-native-reanimated/issues/2735\n        onMomentumScrollEnd={() => {}}\n      >\n        {children}\n      </ScrollViewMemo>\n    )\n  }\n)\n"],"mappings":"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"}