{"version":3,"names":["React","useCallback","StyleSheet","Animated","useSharedValue","useAnimatedReaction","runOnJS","withTiming","useAnimatedStyle","ScrollView","useScroller","useTabNameContext","useTabsContext","Lazy","children","cancelLazyFadeIn","startMounted","_startMounted","mountDelayMs","name","focusedTab","refMap","value","didTriggerLayout","canMount","setCanMount","useState","isSelfMounted","useRef","opacity","useEffect","current","startMountTimer","setTimeout","focused","wasFocused","scrollTo","ref","isMounted","wasMounted","stylez","onLayout","styles","container","undefined","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React, { useCallback } from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  /**\n   * Whether to cancel the lazy fade in animation. Defaults to false.\n   */\n  cancelLazyFadeIn?: boolean\n  /**\n   * How long to wait before mounting the children.\n   */\n  mountDelayMs?: number\n  /**\n   * Whether to start mounted. Defaults to true if we are the focused tab.\n   */\n  startMounted?: boolean\n  children: React.ReactElement\n}> = ({\n  children,\n  cancelLazyFadeIn,\n  startMounted: _startMounted,\n  mountDelayMs = 50,\n}) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap } = useTabsContext()\n\n  /**\n   * We start mounted if we are the focused tab, or if props.startMounted is true.\n   */\n  const startMounted = useSharedValue(\n    typeof _startMounted === 'boolean'\n      ? _startMounted\n      : focusedTab.value === name\n  )\n\n  /**\n   * We keep track of whether a layout has been triggered\n   */\n  const didTriggerLayout = useSharedValue(false)\n\n  /**\n   * This is used to control when children are mounted\n   */\n  const [canMount, setCanMount] = React.useState(!!startMounted.value)\n  /**\n   * Ensure we don't mount after the component has been unmounted\n   */\n  const isSelfMounted = React.useRef(true)\n\n  const opacity = useSharedValue(cancelLazyFadeIn || startMounted.value ? 1 : 0)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const startMountTimer = React.useCallback(() => {\n    // wait the scene to be at least mountDelay ms focused, before mounting\n    setTimeout(() => {\n      if (focusedTab.value === name) {\n        if (isSelfMounted.current) setCanMount(true)\n      }\n    }, mountDelayMs)\n  }, [focusedTab.value, mountDelayMs, name])\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused, wasFocused) => {\n      if (focused && !wasFocused && !canMount) {\n        if (cancelLazyFadeIn) {\n          opacity.value = 1\n          runOnJS(setCanMount)(true)\n        } else {\n          runOnJS(startMountTimer)()\n        }\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useAnimatedReaction(\n    () => {\n      return didTriggerLayout.value\n    },\n    (isMounted, wasMounted) => {\n      if (isMounted && !wasMounted) {\n        if (!cancelLazyFadeIn && opacity.value !== 1) {\n          opacity.value = withTiming(1)\n        }\n      }\n    },\n    [ref, cancelLazyFadeIn, name, didTriggerLayout, scrollTo]\n  )\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [])\n\n  const onLayout = useCallback(() => {\n    didTriggerLayout.value = true\n  }, [didTriggerLayout])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn ? stylez : undefined]}\n        onLayout={onLayout}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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"}